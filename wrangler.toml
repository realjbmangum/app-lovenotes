name = "lovenotes-api"
main = "worker/index.ts"
compatibility_date = "2024-01-01"

[[d1_databases]]
binding = "DB"
database_name = "lovenotes-db"
database_id = "98e6e4fe-c324-4337-b06f-90356b027be9"

[vars]
ENVIRONMENT = "development"
ALLOWED_ORIGIN = "https://sendmylove.app"
SENDGRID_FROM_EMAIL = "hello@sendmylove.app"

# JWT_SECRET should be set via wrangler secret for production:
# wrangler secret put JWT_SECRET

# For local development
[dev]
port = 8787

# Scheduled trigger - runs daily at 8am ET (13:00 UTC)
[triggers]
crons = ["0 13 * * *"]

# Production environment
[env.production]
vars = { ENVIRONMENT = "production", ALLOWED_ORIGIN = "https://sendmylove.app", SENDGRID_FROM_EMAIL = "hello@sendmylove.app" }

[[env.production.d1_databases]]
binding = "DB"
database_name = "lovenotes-db"
database_id = "98e6e4fe-c324-4337-b06f-90356b027be9"

# Production also needs the cron trigger
[env.production.triggers]
crons = ["0 13 * * *"]

# Remember to set these secrets in production:
# wrangler secret put JWT_SECRET --env production
# wrangler secret put SENDGRID_API_KEY
# wrangler secret put SENDGRID_FROM_EMAIL (e.g., noreply@yourdomain.com)
# wrangler secret put TWILIO_ACCOUNT_SID (optional - for SMS)
# wrangler secret put TWILIO_AUTH_TOKEN (optional - for SMS)
# wrangler secret put TWILIO_PHONE_NUMBER (optional - for SMS)
